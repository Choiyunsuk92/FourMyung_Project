<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fourMyung.mapper.MemberMapper" >
<sql id="basecolumn">
	MEM_DIV_CD, USER_ID, USER_PASS, USER_NM, USER_BIRTH, 
	USER_EMAIL, USER_PH, USER_ADDR, USER_GENDER, JOIN_DT, SYS_MDF_DT, JOIN_OK  
</sql>

<insert id="insertMember" parameterType="fourMyung.domain.member.MemberDTO">
	insert into c_member ( <include refid="basecolumn" />  )
		values(#{memDivCd}, #{userId}, #{userPass}, #{userNm}, #{userBirth},
		#{userEmail}, #{userPh}, #{userAddr}, #{userGender}, sysdate, null, null)
</insert>

<update id="joinOkUpdate" parameterType="fourMyung.domain.member.MemberDTO">
	update c_member
	set join_ok = #{joinOk}
	where user_id = #{userId} and USER_EMAIL = #{userEmail}
	and join_ok is null
</update>

<resultMap type="fourMyung.domain.member.MemberDTO" id="baseMember" >
	<constructor>
		<idArg column="user_Id" javaType="string" />
		<arg column="MEM_DIV_CD" javaType="string" />
		<arg column="USER_PASS" javaType="string" />
		<arg column="USER_NM" javaType="string" />
		<arg column="USER_BIRTH" javaType="java.sql.Timestamp"/>
		<arg column="USER_EMAIL" javaType="string" />
		<arg column="USER_PH" javaType="string" />
		<arg column="USER_ADDR" javaType="string" />
		<arg column="USER_GENDER" javaType="string" />
		<arg column="JOIN_DT" javaType="java.sql.Timestamp" />
		<arg column="SYS_MDF_DT" javaType="java.sql.Timestamp" />
		<arg column="JOIN_OK" javaType="string" />
	</constructor>
</resultMap>

<select id="selectByMember" parameterType="fourMyung.domain.member.MemberDTO" resultMap="baseMember">
	select *
	from(select <include refid="basecolumn" /> 	
		 from c_member
	 		  <where>
			  	<if test="userId != null and joinOk != null ">
					user_id = #{userId} 
				</if>
				<if test="userId != null and joinOk == null">
					user_id = #{userId} and join_ok is not null
				</if>
			  </where>
		  order by join_dt desc)
</select>

<update id="memberUpdate" parameterType="fourMyung.domain.member.MemberDTO">
	update c_member
	<trim prefix="set" suffixOverrides=",">
		<if test="userEmail != null">user_email = #{userEmail},</if>
		<if test="userAddr != null">user_addr = #{userAddr},</if>
		<if test="userPh !=null"> user_ph = #{userPh},</if>
	</trim>
	<where>
		user_Id = #{userId}
	</where>	
</update>

<update id="pwChange" parameterType="fourMyung.domain.member.PwChangeDTO">
	update c_member 
	set user_pass = #{newPw}
	where user_id = #{userId}
</update>

<delete id="myInfoDel" parameterType="string">
	delete from c_member 
	<where>
		user_id = #{userId}
	</where> 
</delete>


</mapper>





























